# LEMP Setup Script

This script automates the setup of a **LEMP** (Linux, Nginx, MariaDB, PHP) server on **Ubuntu 20.04 or 22.04**. It configures a single domain with **SSL** (via Let's Encrypt), a **mail server** (Postfix, Dovecot, OpenDKIM), **Roundcube webmail**, **SFTP access**, and **email account creation**. Additional features include firewall setup (UFW), log rotation, configuration backups, and security headers.

## Features
- Installs and configures Nginx, MariaDB, and user-selected PHP version.
- Sets up a domain with Nginx virtual host and SSL certificate.
- Configures a mail server with SPF, DKIM, and DMARC DNS records.
- Installs Roundcube for webmail access.
- Creates an SFTP user for secure file transfers.
- Supports email account creation with IMAP/POP3/SMTP.
- Secures MySQL and configures UFW firewall.
- Backs up configurations and sets up log rotation.

## Prerequisites
- **VPS** running Ubuntu 20.04 or 22.04 with root access.
- **Domain name** with A records (`example.com`, `www.example.com`, `webmail.example.com`) pointing to your VPS's public IP.
- **SSH access** to the VPS.
- Open ports: 22 (SSH), 80 (HTTP), 443 (HTTPS), 25 (SMTP), 110 (POP3), 143 (IMAP), 465 (SMTPS), 587 (Submission), 993 (IMAPS), 995 (POP3S).
- Git installed on the VPS (`apt install git`).

## Installation
1. **Clone the Repository**:
   ```bash
   git clone https://github.com/Yogesh0610/Lemp-Setup.git
   cd Lemp-Setup
   ```

2. **Set Execute Permissions**:
   ```bash
   chmod +x lemp_setup.sh
   ```

3. **Run the Script**:
   ```bash
   sudo bash lemp_setup.sh
   ```

## Usage
1. **Run the Script**:
   - Execute the script as root (`sudo bash lemp_setup.sh`).
   - Follow the interactive prompts:
     - **Domain Name**: Enter your domain (e.g., `example.com`).
     - **PHP Version**: Select a PHP version (e.g., 8.1) or keep the default.
     - **SFTP Setup**: Choose a domain and confirm SFTP user creation.
     - **Email Creation**: Select a domain and provide an email username (e.g., `user` for `user@example.com`).

2. **Add DNS Records**:
   - The script outputs DNS records for SPF, DKIM, and DMARC. Add these to your DNS provider:
     - **SPF**: `TXT @ v=spf1 a mx ~all`
     - **DKIM**: `TXT mail._domainkey <dkim_record>` (use the script-provided value).
     - **DMARC**: `TXT _dmarc v=DMARC1; p=none; rua=mailto:dmarc-reports@yourdomain.com;`

3. **Test the Setup**:
   - **Website**: Visit `https://yourdomain.com` (displays PHP info).
   - **Webmail**: Access `https://webmail.yourdomain.com` with the generated email credentials.
   - **SFTP**: Connect using the provided SFTP user, password, host, and port 22.
   - **Email**: Configure an email client:
     - IMAP: `yourdomain.com`, port 993, SSL/TLS
     - SMTP: `yourdomain.com`, port 587, STARTTLS
     - Username: `user@yourdomain.com`
     - Password: Generated by the script

## Output and Logs
- **Log File**: Setup details and errors are logged to `/var/log/lemp_setup_YYYY-MM-DD_HH-MM-SS.log`.
- **Credentials**: The script outputs SFTP and email credentials. Save these securely.
- **Backups**: Configurations are backed up to `/root/backups/lemp_YYYY-MM-DD_HH-MM-SS`.

## Troubleshooting
- **Script Fails**:
  - Check the log file: `cat /var/log/lemp_setup_*.log`.
  - Ensure DNS A records are set and propagated.
  - Verify ports are open: `ufw status`.
- **Mail Issues**:
  - Test mail server: `telnet yourdomain.com 25`.
  - Check logs: `/var/log/mail.log`.
- **Nginx Errors**:
  - Validate configuration: `nginx -t`.
  - Check status: `systemctl status nginx`.
- **SSL Issues**:
  - Test renewal: `certbot renew --dry-run`.
  - Verify certificate: `openssl s_client -connect yourdomain.com:443`.
- **Permissions**:
  - Ensure correct ownership: `chown -R www-data:www-data /var/www/yourdomain`.

## Maintenance
- **Update System**: `apt update && apt upgrade -y`.
- **Monitor Logs**: Check `/var/www/yourdomain/logs/` and `/var/log/`.
- **Secure VPS**: Consider adding Fail2Ban and SSH key authentication.
- **SSL Renewal**: Certbot handles auto-renewal, but verify periodically.

## Contributing
Feel free to fork this repository, submit issues, or create pull requests to improve the script.

## License
This project is licensed under the MIT License.